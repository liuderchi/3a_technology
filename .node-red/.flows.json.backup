[{"id":"49459178.c9087","type":"tab","label":"heroku server","disabled":false,"info":""},{"id":"d93293b4.bc7c7","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"6962b061.aeb91","type":"http request","z":"49459178.c9087","name":"LINE REPLY API","method":"POST","ret":"txt","paytoqs":false,"url":"https://api.line.me/v2/bot/message/reply","tls":"","persist":false,"proxy":"","authType":"","x":670,"y":160,"wires":[[]]},{"id":"8947272.c0846d8","type":"http in","z":"49459178.c9087","name":"line bot server","url":"/linebot","method":"post","upload":false,"swaggerDoc":"","x":110,"y":160,"wires":[["3230da25.170a46","942a2464.2ebee8","bc3973ae.6ca2"]]},{"id":"f090bb85.5480d8","type":"comment","z":"49459178.c9087","name":"node-red heroku 將訊息回復至line伺服器","info":"","x":740,"y":120,"wires":[]},{"id":"3230da25.170a46","type":"debug","z":"49459178.c9087","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":390,"y":60,"wires":[]},{"id":"86ab75ed.4a0028","type":"function","z":"49459178.c9087","name":"應聲蟲","func":"var event = msg.payload[\"events\"][0];\nif(event[\"message\"][\"type\"] != \"text\"){\n    return msg;\n}\n\nvar message = event[\"message\"][\"text\"];\ncontext.global.replyToken = event[\"replyToken\"];\n\nvar replyMessage = {\"type\": \"text\", \"text\": messge};\n\nmsg.payload = {\"messages\": [replyMessage],\"replyToken\": context.global.replyToken}; \nmsg.headers  = {\"Content-Type\": \"application/json\",\"Authorization\": \"Bearer \"+context.global.token}; \nmsg.payload.headers = msg.headers;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":350,"y":140,"wires":[[]]},{"id":"942a2464.2ebee8","type":"function","z":"49459178.c9087","name":"回應名片資訊","func":"var event = msg.payload[\"events\"][0];\nif(event[\"message\"][\"type\"] != \"text\"){\n    return msg;\n}\n\nvar message = event[\"message\"][\"text\"];\ncontext.global.replyToken = event[\"replyToken\"];\n\nvar replyTemplate = {\"type\": \"template\", \"altText\": \"名片管理\",\"template\":{\n    type: 'confirm',\n    text: '名片資訊',\n    actions: [{\n      type: 'message',\n      label: 'Jason',\n      text: 'Jason名片'\n    }, {\n      type: 'message',\n      label: 'Cathy',\n      text: 'Cathy名片'\n    }]\n  }};\n\n\nif(message==\"名片\")\n{\n    msg.payload = {\"messages\": [replyTemplate],\"replyToken\": context.global.replyToken};\n    msg.headers  = {\"Content-Type\": \"application/json\",\"Authorization\": \"Bearer \"+context.global.token}; \n    return msg;\n}","outputs":1,"noerr":0,"x":360,"y":200,"wires":[["6962b061.aeb91"]]},{"id":"1d5809ae.30e3a6","type":"inject","z":"49459178.c9087","name":"token set","topic":"","payload":"rmKos2MuICJwAMg6wPW/7Gdh9MircQxXLZ7BjCbXHG+IdD29LfFFXHgFgNrzq7M8kBc+GD9YZOT4oITZG0aMaRdCdWbeuWjnvoLET2cMTtej/jViP6x8EtH3Ql6RerM8P+64CfmkEEgpYxB8dGUHRQdB04t89/1O/w1cDnyilFU=","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"2","x":140,"y":360,"wires":[["c059efc4.21fbb","c344d73d.058758"]]},{"id":"3cf0dc66.6b5ff4","type":"comment","z":"49459178.c9087","name":"token","info":"","x":121.20000457763672,"y":321.3999843597412,"wires":[]},{"id":"c059efc4.21fbb","type":"function","z":"49459178.c9087","name":"","func":"context.global.token = msg.payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":301.7000026702881,"y":361.20000076293945,"wires":[[]]},{"id":"c344d73d.058758","type":"function","z":"49459178.c9087","name":"電子名片init","func":"context.global.bussiness_card['Jason'] = {\n  \"type\": \"carousel\",\n  \"contents\": [\n    {\n      \"type\": \"bubble\",\n      \"hero\": {\n        \"type\": \"image\",\n        \"size\": \"full\",\n        \"aspectRatio\": \"20:13\",\n        \"aspectMode\": \"cover\",\n        \"url\": \"https://imgur.com/zCYprab.jpg\"\n      },\n      \"body\": {\n        \"type\": \"box\",\n        \"layout\": \"vertical\",\n        \"spacing\": \"sm\",\n        \"contents\": [\n          {\n            \"type\": \"text\",\n            \"text\": \"阿蓁🌻Cathy\",\n            \"wrap\": true,\n            \"weight\": \"bold\",\n            \"size\": \"xl\"\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"baseline\",\n            \"contents\": [\n              {\n                \"type\": \"text\",\n                \"text\": \"向日樹數位轉型x人才培訓-創辦人\",\n                \"wrap\": true,\n                \"weight\": \"bold\",\n                \"size\": \"md\",\n                \"flex\": 0\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"baseline\",\n            \"contents\": [\n              {\n                \"type\": \"text\",\n                \"text\": \"山雲創新科技-教育推廣經理兼講師\",\n                \"wrap\": true,\n                \"weight\": \"bold\",\n                \"size\": \"md\",\n                \"flex\": 0\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"baseline\",\n            \"contents\": [\n              {\n                \"type\": \"text\",\n                \"text\": \"柯林廣告&建設-行銷業務經理\",\n                \"wrap\": true,\n                \"weight\": \"bold\",\n                \"size\": \"md\",\n                \"flex\": 0\n              }\n            ]\n          }\n        ]\n      },\n      \"footer\": {\n        \"type\": \"box\",\n        \"layout\": \"vertical\",\n        \"spacing\": \"sm\",\n        \"contents\": [\n          {\n            \"type\": \"button\",\n            \"style\": \"primary\",\n            \"action\": {\n              \"type\": \"uri\",\n              \"label\": \"與我聯繫\",\n              \"uri\": \"https://line.me/ti/p/9iGVGw7uUK\"\n            },\n            \"color\": \"#00ACC7\"\n          },\n          {\n            \"type\": \"button\",\n            \"style\": \"primary\",\n            \"action\": {\n              \"type\": \"uri\",\n              \"label\": \"分享我的名片\",\n              \"uri\": \"https://liff.line.me/1655113925-Ekzb35k3\"\n            },\n            \"color\": \"#00ACC7\"\n          }\n        ]\n      }\n    },\n    {\n      \"type\": \"bubble\",\n      \"hero\": {\n        \"type\": \"image\",\n        \"size\": \"full\",\n        \"aspectRatio\": \"20:13\",\n        \"aspectMode\": \"cover\",\n        \"url\": \"https://imgur.com/ediZum8.jpg\"\n      },\n      \"body\": {\n        \"type\": \"box\",\n        \"layout\": \"vertical\",\n        \"spacing\": \"sm\",\n        \"contents\": [\n          {\n            \"type\": \"text\",\n            \"text\": \"人才培訓🌻授課經歷\",\n            \"wrap\": true,\n            \"weight\": \"bold\",\n            \"size\": \"xl\"\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"baseline\",\n            \"contents\": [\n              {\n                \"type\": \"text\",\n                \"text\": \"國立台北商業大學夢想大學講座\",\n                \"wrap\": true,\n                \"weight\": \"bold\",\n                \"size\": \"xs\",\n                \"flex\": 0\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"baseline\",\n            \"contents\": [\n              {\n                \"type\": \"text\",\n                \"text\": \"僑光科技大學行銷業界講師\",\n                \"wrap\": true,\n                \"weight\": \"bold\",\n                \"size\": \"xs\",\n                \"flex\": 0\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"baseline\",\n            \"contents\": [\n              {\n                \"type\": \"text\",\n                \"text\": \"金甌女中多媒體科技職講師\",\n                \"wrap\": true,\n                \"weight\": \"bold\",\n                \"size\": \"xs\",\n                \"flex\": 0\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"baseline\",\n            \"contents\": [\n              {\n                \"type\": \"text\",\n                \"text\": \"臺北市立圖書館推廣活動講師\",\n                \"wrap\": true,\n                \"weight\": \"bold\",\n                \"size\": \"xs\",\n                \"flex\": 0\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"baseline\",\n            \"contents\": [\n              {\n                \"type\": \"text\",\n                \"text\": \"臺北市立螢橋國中、成淵中學、景興國中業師\",\n                \"wrap\": true,\n                \"weight\": \"bold\",\n                \"size\": \"xs\",\n                \"flex\": 0\n              }\n            ]\n          }\n        ]\n      },\n      \"footer\": {\n        \"type\": \"box\",\n        \"layout\": \"vertical\",\n        \"spacing\": \"sm\",\n        \"contents\": [\n          {\n            \"type\": \"button\",\n            \"flex\": 2,\n            \"style\": \"primary\",\n            \"color\": \"#00ACC7\",\n            \"action\": {\n              \"type\": \"uri\",\n              \"label\": \"官方網站\",\n              \"uri\": \"https://3anology.com.tw/\"\n            }\n          }\n        ]\n      }\n    },\n    {\n      \"type\": \"bubble\",\n      \"hero\": {\n        \"type\": \"image\",\n        \"size\": \"full\",\n        \"aspectRatio\": \"20:13\",\n        \"aspectMode\": \"cover\",\n        \"url\": \"https://imgur.com/WgHrYH0.jpg\"\n      },\n      \"body\": {\n        \"type\": \"box\",\n        \"layout\": \"vertical\",\n        \"spacing\": \"sm\",\n        \"contents\": [\n          {\n            \"type\": \"text\",\n            \"text\": \"多媒體設計🌻服務項目\",\n            \"wrap\": true,\n            \"weight\": \"bold\",\n            \"size\": \"xl\"\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"baseline\",\n            \"contents\": [\n              {\n                \"type\": \"text\",\n                \"text\": \"LINE電子名片\",\n                \"wrap\": true,\n                \"weight\": \"bold\",\n                \"size\": \"md\",\n                \"flex\": 0\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"baseline\",\n            \"contents\": [\n              {\n                \"type\": \"text\",\n                \"text\": \"LINE官方帳號2.0\",\n                \"wrap\": true,\n                \"weight\": \"bold\",\n                \"size\": \"md\",\n                \"flex\": 0\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"baseline\",\n            \"contents\": [\n              {\n                \"type\": \"text\",\n                \"text\": \"LINE貼圖\",\n                \"wrap\": true,\n                \"weight\": \"bold\",\n                \"size\": \"md\",\n                \"flex\": 0\n              }\n            ]\n          },\n          {\n            \"type\": \"box\",\n            \"layout\": \"baseline\",\n            \"contents\": [\n              {\n                \"type\": \"text\",\n                \"text\": \"文創周邊商品\",\n                \"wrap\": true,\n                \"weight\": \"bold\",\n                \"size\": \"md\",\n                \"flex\": 0\n              }\n            ]\n          }\n        ]\n      },\n      \"footer\": {\n        \"type\": \"box\",\n        \"layout\": \"vertical\",\n        \"spacing\": \"sm\",\n        \"contents\": [\n          {\n            \"type\": \"button\",\n            \"flex\": 2,\n            \"style\": \"primary\",\n            \"color\": \"#00ACC7\",\n            \"action\": {\n              \"type\": \"uri\",\n              \"label\": \"LINE官方帳號\",\n              \"uri\": \"https://line.me/R/ti/p/%40xfa0129y\"\n            }\n          }\n        ]\n      }\n    }\n  ]\n}\n\n\n\n","outputs":1,"noerr":0,"x":310,"y":420,"wires":[[]]},{"id":"bc3973ae.6ca2","type":"function","z":"49459178.c9087","name":"回應名片內容 flex message","func":"var event = msg.payload[\"events\"][0];\nif(event[\"message\"][\"type\"] != \"text\"){\n    return msg;\n}\n\nvar message = event[\"message\"][\"text\"];\ncontext.global.replyToken = event[\"replyToken\"];\n\n\nif(context.global.bussiness_card.hasOwnProperty(message))\n{\n    var replycarousel = \n    {\n        \"type\": \"flex\",\n        \"altText\": \"山雲科技電子名片\",\n        \"contents\": context.global.bussiness_card[message]\n    }\n    msg.payload = {\"messages\": [replyTemplate],\"replyToken\": context.global.replyToken};\n    msg.headers  = {\"Content-Type\": \"application/json\",\"Authorization\": \"Bearer \"+context.global.token}; \n    return msg;\n}","outputs":1,"noerr":0,"x":360,"y":260,"wires":[["6962b061.aeb91"]]}]